@startuml
autonumber

' Definisi Aktor dan Peserta
participant "Mobil (Pengunjung)" as Mobil
participant "Arduino (Sensor IR)" as Arduino
participant "Server (Backend API)" as Server
database "Database (MySQL)" as DB
participant "Web Dashboard (Admin)" as Web

' == FASE 1 ==
box "Area Parkir" #LightBlue
    participant Mobil
    participant Arduino
end box

== FASE 1: DETEKSI dan LOGGING ==

Mobil -> Arduino: Melewati Sensor
activate Arduino
Arduino -> Arduino: Validasi Sinyal

Arduino -> Server: HTTP POST (arah=MASUK)
activate Server

Server -> DB: INSERT INTO parking_logs
activate DB
DB --> Server: Simpan Berhasil
deactivate DB

Server --> Arduino: Response 200 OK
deactivate Server

Arduino -> Arduino: Reset Status Sensor
deactivate Arduino

' == FASE 2 ==
== FASE 2: UPDATE TAMPILAN ==

loop Setiap 3 Detik
    Web -> Server: GET Request (Minta Data)
    activate Web
    activate Server
    
    Server -> DB: Query Hitung (Masuk - Keluar)
    activate DB
    DB --> Server: Return Jumlah Mobil
    deactivate DB
    
    Server -> DB: Query Cek Kapasitas Total
    activate DB
    DB --> Server: Return Kapasitas
    deactivate DB
    
    Server -> Server: Hitung Sisa Slot
    
    Server --> Web: JSON {sisa_slot: 50}
    deactivate Server
    
    Web -> Web: Update UI (Hijau/Merah)
    deactivate Web
end

@enduml